const sendGridAPI = require('config').secretModule.sendGridAPI;
const nodemailer = require('nodemailer');
const sgTransport = require('nodemailer-sendgrid-transport');

const mailer = nodemailer.createTransport(sgTransport({
  auth: {
    api_key: sendGridAPI,
  },
}));

/**
 * sendEmail is a function using which dev can send email to users
 * @option  {object}   option   options must include to, from, subject, text
 *                              and html
 * @callback  {Function} callback dev provided callback to call
 * @return {callback}           calls callback
 */
function sendEmail(option, callback) {
  if (!option.to ||
    !option.from ||
    !option.subject ||
    !option.text ||
    !option.html
  ) {
    return callback(new Error('Parameter missing in sendEmail function'));
  }
  const { to, from, subject, text, html } = option;
  const email = { to, from, subject, text, html };

  return mailer.sendMail(email, callback);
}

module.exports = {
  sendEmail,
};
